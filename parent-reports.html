<!-- the following is the completed code for DTES/parent-reports.html:  -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>التقارير - DT Edu</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --primary: #4a6cf7;
        --primary-dark: #3a56d4;
        --secondary: #6c5ce7;
        --accent: #00b894;
        --light: #f8f9fa;
        --dark: #2d3436;
        --text: #333;
        --text-light: #666;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
        --sidebar-width: 260px;
      }

      .dark-mode {
        --light: #1a1a2e;
        --dark: #f8f9fa;
        --text: #e6e6e6;
        --text-light: #b0b0b0;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Tajawal", "Segoe UI", sans-serif;
      }

      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #f0f8ff 0%, #e1f0fa 100%);
        transition: var(--transition);
      }

      body.dark-mode {
        background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
      }

      body.rtl {
        direction: rtl;
      }
      body.ltr {
        direction: ltr;
      }

      .dashboard-container {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: var(--sidebar-width);
        background: linear-gradient(
          180deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        color: white;
        padding: 20px 0;
        box-shadow: var(--shadow);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        transition: var(--transition);
        z-index: 100;
      }

      body.rtl .sidebar {
        right: 0;
      }
      body.ltr .sidebar {
        left: 0;
      }
      body.rtl .main-content {
        margin-right: var(--sidebar-width);
      }
      body.ltr .main-content {
        margin-left: var(--sidebar-width);
        margin-right: 0;
      }

      .sidebar-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 20px;
      }

      .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
      }

      .logo {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      .logo img {
        width: 140px;
        object-fit: contain;
        display: block;
      }

      .logo-text {
        font-size: 24px;
        font-weight: 800;
        background: linear-gradient(135deg, white, #e1f0fa);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .user-info {
        text-align: center;
        margin-top: 10px;
      }

      .user-name {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 5px;
      }

      .user-type {
        background: rgba(255, 255, 255, 0.2);
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 14px;
      }

      .sidebar-menu {
        list-style: none;
        padding: 0 15px;
      }

      .menu-item {
        margin-bottom: 8px;
        border-radius: 10px;
      }

      .menu-item a {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        color: white;
        text-decoration: none;
        transition: var(--transition);
      }

      .menu-item a:hover,
      .menu-item.active a {
        background: rgba(255, 255, 255, 0.15);
      }

      body.rtl .menu-item a:hover,
      body.rtl .menu-item.active a {
        transform: translateX(-5px);
      }
      body.ltr .menu-item a:hover,
      body.ltr .menu-item.active a {
        transform: translateX(5px);
      }

      .menu-item i {
        font-size: 18px;
        width: 24px;
        text-align: center;
      }

      body.rtl .menu-item i {
        margin-left: 10px;
      }
      body.ltr .menu-item i {
        margin-right: 10px;
      }

      .sidebar-footer {
        padding: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        margin-top: 20px;
      }

      .main-content {
        flex: 1;
        padding: 20px;
        transition: var(--transition);
      }

      .header {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 20px;
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: var(--transition);
      }

      body.dark-mode .header {
        background: var(--light);
        color: var(--dark);
      }

      .header h1 {
        color: var(--primary);
        font-size: 28px;
        font-weight: 700;
      }

      .header-actions {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .dark-mode-toggle,
      .logout-btn {
        padding: 10px 15px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .dark-mode-toggle {
        background: rgba(74, 108, 247, 0.1);
        color: var(--primary);
      }

      .dark-mode-toggle:hover {
        background: rgba(74, 108, 247, 0.2);
      }

      .logout-btn {
        background: rgba(231, 76, 60, 0.1);
        color: #e74c3c;
      }

      .logout-btn:hover {
        background: rgba(231, 76, 60, 0.2);
      }

      .children-selector {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 20px;
        margin-bottom: 25px;
      }

      body.dark-mode .children-selector {
        background: var(--light);
      }

      .children-tabs {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .child-tab {
        padding: 12px 20px;
        border-radius: 10px;
        border: 2px solid var(--primary);
        background: transparent;
        color: var(--primary);
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .child-tab:hover,
      .child-tab.active {
        background: var(--primary);
        color: white;
      }

      .report-selector {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 20px;
        margin-bottom: 25px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
      }

      body.dark-mode .report-selector {
        background: var(--light);
      }

      .selector-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .selector-group label {
        font-weight: 600;
        color: var(--text);
      }

      .selector-group select {
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        background: #f8f9fa;
        color: var(--text);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        min-width: 150px;
      }

      body.dark-mode .selector-group select {
        background: var(--light);
        border-color: rgba(255, 255, 255, 0.1);
      }

      .download-btn {
        background: var(--accent);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        margin-right: auto;
      }

      body.ltr .download-btn {
        margin-right: 0;
        margin-left: auto;
      }

      .download-btn:hover {
        background: #00a178;
        transform: translateY(-2px);
      }

      .report-card {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 30px;
        margin-bottom: 25px;
      }

      body.dark-mode .report-card {
        background: var(--light);
        color: var(--dark);
      }

      .card-title {
        font-size: 22px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(74, 108, 247, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .summary-item {
        text-align: center;
        padding: 20px;
        background: rgba(74, 108, 247, 0.05);
        border-radius: 10px;
        transition: var(--transition);
      }

      body.dark-mode .summary-item {
        background: rgba(74, 108, 247, 0.15);
      }

      .summary-item:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
      }

      .summary-value {
        font-size: 36px;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 10px;
      }

      .summary-label {
        color: var(--text-light);
        font-weight: 600;
      }

      .grades-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .grades-table th,
      .grades-table td {
        padding: 15px;
        border-bottom: 1px solid #eee;
      }

      body.dark-mode .grades-table th,
      body.dark-mode .grades-table td {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      body.rtl .grades-table th,
      body.rtl .grades-table td {
        text-align: right;
      }

      body.ltr .grades-table th,
      body.ltr .grades-table td {
        text-align: left;
      }

      .grades-table th {
        background: rgba(74, 108, 247, 0.1);
        color: var(--primary);
        font-weight: 600;
      }

      .grade-excellent {
        color: #00b894;
        font-weight: 700;
      }
      .grade-good {
        color: var(--primary);
        font-weight: 700;
      }
      .grade-average {
        color: #f39c12;
        font-weight: 700;
      }
      .grade-poor {
        color: #e74c3c;
        font-weight: 700;
      }

      .chart-container {
        margin-top: 30px;
        height: 300px;
        position: relative;
      }

      .progress-bars {
        margin-top: 20px;
      }

      .progress-item {
        margin-bottom: 20px;
      }

      .progress-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .progress-label {
        font-weight: 600;
        color: var(--text);
      }

      .progress-value {
        font-weight: 700;
        color: var(--primary);
      }

      .progress-bar-bg {
        width: 100%;
        height: 25px;
        background: rgba(74, 108, 247, 0.1);
        border-radius: 12px;
        overflow: hidden;
      }

      .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding: 0 10px;
        color: white;
        font-weight: 700;
        font-size: 12px;
        transition: width 1s ease;
      }

      .achievements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .achievement-card {
        background: rgba(243, 156, 18, 0.05);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        transition: var(--transition);
        border: 2px solid transparent;
      }

      .achievement-card:hover {
        border-color: #f39c12;
        transform: translateY(-5px);
      }

      .achievement-icon {
        font-size: 48px;
        color: #f39c12;
        margin-bottom: 15px;
      }

      .achievement-title {
        font-weight: 700;
        color: var(--text);
        margin-bottom: 5px;
      }

      .achievement-desc {
        color: var(--text-light);
        font-size: 14px;
      }

      @media (max-width: 992px) {
        .sidebar {
          width: 80px;
        }
        .sidebar-header .logo-text,
        .user-info,
        .menu-item span {
          display: none;
        }
        body.rtl .main-content {
          margin-right: 80px;
        }
        body.ltr .main-content {
          margin-left: 80px;
        }
        .menu-item a {
          justify-content: center;
          padding: 15px;
        }
        .menu-item i {
          margin: 0;
          font-size: 20px;
        }
      }

      @media (max-width: 768px) {
        .summary-grid,
        .achievements-grid {
          grid-template-columns: 1fr;
        }
        .header {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }
        .report-selector {
          flex-direction: column;
          align-items: stretch;
        }
        .download-btn {
          margin: 0;
        }
      }

      @media (max-width: 576px) {
        .main-content {
          padding: 15px;
        }
        .sidebar {
          width: 70px;
        }
        body.rtl .main-content {
          margin-right: 70px;
        }
        body.ltr .main-content {
          margin-left: 70px;
        }
      }
    </style>
  </head>
  <body class="rtl">
    <div class="dashboard-container">
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <img src="logo.png" alt="Logo" />
          </div>
          <div class="logo-text">DT Edu</div>
          <div class="user-info">
            <div class="user-name" id="user-name">ولي الأمر</div>
            <div class="user-type" id="user-type">Parent</div>
          </div>
        </div>

        <ul class="sidebar-menu">
          <li class="menu-item">
            <a href="parent-dashboard.html">
              <i class="fas fa-home"></i>
              <span id="menu-dashboard">لوحة التحكم</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-children.html">
              <i class="fas fa-child"></i>
              <span id="menu-children">الأبناء</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-homework.html">
              <i class="fas fa-clipboard-list"></i>
              <span id="menu-homework">الواجبات المنزلية</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-calendar.html">
              <i class="fas fa-calendar-alt"></i>
              <span id="menu-calendar">الجدول والفعاليات</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-attendance.html">
              <i class="fas fa-calendar-check"></i>
              <span id="menu-attendance">الحضور والغياب</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-grades.html">
              <i class="fas fa-chart-line"></i>
              <span id="menu-grades">الدرجات والتقييمات</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-messages.html">
              <i class="fas fa-comments"></i>
              <span id="menu-messages">الرسائل</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-payments.html">
              <i class="fas fa-money-bill-wave"></i>
              <span id="menu-payments">المدفوعات</span>
            </a>
          </li>
          <li class="menu-item active">
            <a href="parent-reports.html">
              <i class="fas fa-file-alt"></i>
              <span id="menu-reports">التقارير</span>
            </a>
          </li>
          <li class="menu-item">
            <a href="parent-settings.html">
              <i class="fas fa-cog"></i>
              <span id="menu-settings">الإعدادات</span>
            </a>
          </li>
        </ul>

        <div class="sidebar-footer">
          <ul class="sidebar-menu">
            <li class="menu-item">
              <a href="#" id="sidebar-dark-mode-toggle" style="display: none">
                <i class="fas fa-moon"></i>
                <span id="dark-mode-text">الوضع الداكن</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="#" id="sidebar-language-toggle">
                <i class="fas fa-language"></i>
                <span id="language-text">English</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="index.html">
                <i class="fas fa-sign-out-alt"></i>
                <span id="logout-text">تسجيل الخروج</span>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="main-content">
        <div class="header">
          <h1 id="page-title">التقارير الأكاديمية</h1>
          <div class="header-actions">
            <button
              class="dark-mode-toggle"
              id="dark-mode-toggle"
              style="display: none"
            >
              <i class="fas fa-moon"></i>
              <span id="header-dark-mode-text">الوضع الداكن</span>
            </button>
            <button
              class="logout-btn"
              onclick="window.location.href='index.html'"
            >
              <i class="fas fa-sign-out-alt"></i>
              <span id="header-logout-text">تسجيل الخروج</span>
            </button>
          </div>
        </div>

        <div class="children-selector">
          <h3
            id="select-child-title"
            style="margin-bottom: 15px; color: var(--text)"
          >
            اختر الابن/الابنة:
          </h3>
          <div class="children-tabs">
            <button class="child-tab active" data-child="أحمد محمد">
              <i class="fas fa-user"></i>
              <span>أحمد محمد</span>
            </button>
            <button class="child-tab" data-child="فاطمة محمد">
              <i class="fas fa-user"></i>
              <span>فاطمة محمد</span>
            </button>
            <button class="child-tab" data-child="عمر محمد">
              <i class="fas fa-user"></i>
              <span>عمر محمد</span>
            </button>
          </div>
        </div>

        <div class="report-selector">
          <div class="selector-group">
            <label id="report-type-label">نوع التقرير:</label>
            <select id="report-type">
              <option id="report-academic">التقرير الأكاديمي</option>
              <option id="report-attendance">تقرير الحضور</option>
              <option id="report-behavior">تقرير السلوك</option>
              <option id="report-comprehensive">تقرير شامل</option>
            </select>
          </div>
          <div class="selector-group">
            <label id="period-label">الفترة:</label>
            <select id="report-period">
              <option id="period-term1">الفصل الأول</option>
              <option id="period-term2">الفصل الثاني</option>
              <option id="period-year">السنة الكاملة</option>
            </select>
          </div>
          <button class="download-btn" onclick="downloadReport()">
            <i class="fas fa-download"></i>
            <span id="download-report-text">تحميل التقرير (PDF)</span>
          </button>
        </div>

        <div class="report-card">
          <h2 class="card-title">
            <i class="fas fa-chart-pie"></i>
            <span id="summary-title">ملخص الأداء - الفصل الأول</span>
          </h2>
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-value" id="summary-overall-value">88%</div>
              <div class="summary-label" id="overall-avg">المعدل العام</div>
            </div>
            <div class="summary-item">
              <div class="summary-value" id="summary-rank-value">3/8</div>
              <div class="summary-label" id="class-rank">الترتيب على الصف</div>
            </div>
            <div class="summary-item">
              <div class="summary-value" id="summary-attendance-value">95%</div>
              <div class="summary-label" id="attendance-rate">نسبة الحضور</div>
            </div>
            <div class="summary-item">
              <div class="summary-value" id="summary-behavior-value">ممتاز</div>
              <div class="summary-label" id="behavior-rating">تقييم السلوك</div>
            </div>
          </div>
        </div>

        <div class="report-card">
          <h2 class="card-title">
            <i class="fas fa-graduation-cap"></i>
            <span id="subjects-performance-title"
              >الأداء في المواد الدراسية</span
            >
          </h2>
          <table class="grades-table">
            <thead>
              <tr>
                <th id="th-subject">المادة</th>
                <th id="th-first-exam">الاختبار الأول</th>
                <th id="th-mid-term">منتصف الفصل</th>
                <th id="th-final">النهائي</th>
                <th id="th-total">المجموع</th>
                <th id="th-grade">التقدير</th>
              </tr>
            </thead>
            <tbody id="grades-tbody"></tbody>
          </table>

          <div class="chart-container">
            <canvas id="performanceChart"></canvas>
          </div>
        </div>

        <div class="report-card">
          <h2 class="card-title">
            <i class="fas fa-chart-line"></i>
            <span id="skills-title">تطور المهارات</span>
          </h2>
          <div class="progress-bars">
            <div class="progress-item">
              <div class="progress-header">
                <span class="progress-label" id="skill-math"
                  >التفكير الرياضي</span
                >
                <span class="progress-value">95%</span>
              </div>
              <div class="progress-bar-bg">
                <div
                  class="progress-bar-fill"
                  id="skill-math-fill"
                  style="width: 95%"
                >
                  95%
                </div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-header">
                <span class="progress-label" id="skill-language"
                  >المهارات اللغوية</span
                >
                <span class="progress-value">87%</span>
              </div>
              <div class="progress-bar-bg">
                <div
                  class="progress-bar-fill"
                  id="skill-language-fill"
                  style="width: 87%"
                >
                  87%
                </div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-header">
                <span class="progress-label" id="skill-critical"
                  >التفكير النقدي</span
                >
                <span class="progress-value">90%</span>
              </div>
              <div class="progress-bar-bg">
                <div
                  class="progress-bar-fill"
                  id="skill-critical-fill"
                  style="width: 90%"
                >
                  90%
                </div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-header">
                <span class="progress-label" id="skill-teamwork"
                  >العمل الجماعي</span
                >
                <span class="progress-value">92%</span>
              </div>
              <div class="progress-bar-bg">
                <div
                  class="progress-bar-fill"
                  id="skill-teamwork-fill"
                  style="width: 92%"
                >
                  92%
                </div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-header">
                <span class="progress-label" id="skill-creativity"
                  >الإبداع والابتكار</span
                >
                <span class="progress-value">85%</span>
              </div>
              <div class="progress-bar-bg">
                <div
                  class="progress-bar-fill"
                  id="skill-creativity-fill"
                  style="width: 85%"
                >
                  85%
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="report-card">
          <h2 class="card-title">
            <i class="fas fa-trophy"></i>
            <span id="achievements-title">الإنجازات والجوائز</span>
          </h2>
          <div class="achievements-grid" id="achievements-grid"></div>
        </div>
      </div>
    </div>

    <script src="core.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.2.4/dist/dexie.min.js"></script>
    <script src="db.js"></script>
    <script>
      const translations = {
        ar: {
          pageTitle: "التقارير الأكاديمية",
          userType: "ولي أمر",
          menuDashboard: "لوحة التحكم",
          menuChildren: "الأبناء",
          menuHomework: "الواجبات المنزلية",
          menuCalendar: "الجدول والفعاليات",
          menuAttendance: "الحضور والغياب",
          menuGrades: "الدرجات والتقييمات",
          menuMessages: "الرسائل",
          menuPayments: "المدفوعات",
          menuReports: "التقارير",
          menuSettings: "الإعدادات",
          darkModeText: "الوضع الداكن",
          languageText: "English",
          logoutText: "تسجيل الخروج",
          selectChildTitle: "اختر الابن/الابنة:",
          downloadReportText: "تحميل التقرير (PDF)",
        },
        en: {
          pageTitle: "Academic Reports",
          userType: "Parent",
          menuDashboard: "Dashboard",
          menuChildren: "Children",
          menuHomework: "Homework",
          menuCalendar: "Schedule & Events",
          menuAttendance: "Attendance",
          menuGrades: "Grades",
          menuMessages: "Messages",
          menuPayments: "Payments",
          menuReports: "Reports",
          menuSettings: "Settings",
          darkModeText: "Dark Mode",
          languageText: "العربية",
          logoutText: "Logout",
          selectChildTitle: "Select Child:",
          downloadReportText: "Download Report (PDF)",
        },
      };

      let currentChild = "أحمد محمد";
      let performanceChart;
      const subjectLabels = {
        ar: [
          "الرياضيات",
          "العلوم",
          "العربية",
          "الإنجليزية",
          "الاجتماعيات",
          "التربية الإسلامية",
          "الفنية",
          "البدنية",
        ],
        en: [
          "Mathematics",
          "Science",
          "Arabic",
          "English",
          "Social Studies",
          "Islamic Studies",
          "Art",
          "Physical Education",
        ],
      };
      const gradeText = {
        ar: {
          excellent: "ممتاز",
          good: "جيد جداً",
          average: "جيد",
          poor: "ضعيف",
        },
        en: {
          excellent: "Excellent",
          good: "Very Good",
          average: "Good",
          poor: "Poor",
        },
      };

      function updateLanguage(lang) {
        const t = translations[lang];
        document.getElementById("page-title").textContent = t.pageTitle;
        document.getElementById("user-type").textContent = t.userType;
        document.getElementById("menu-dashboard").textContent = t.menuDashboard;
        document.getElementById("menu-children").textContent = t.menuChildren;
        document.getElementById("menu-homework").textContent = t.menuHomework;
        document.getElementById("menu-calendar").textContent = t.menuCalendar;
        document.getElementById("menu-attendance").textContent =
          t.menuAttendance;
        document.getElementById("menu-grades").textContent = t.menuGrades;
        document.getElementById("menu-messages").textContent = t.menuMessages;
        document.getElementById("menu-payments").textContent = t.menuPayments;
        document.getElementById("menu-reports").textContent = t.menuReports;
        document.getElementById("menu-settings").textContent = t.menuSettings;
        document.getElementById("dark-mode-text").textContent = t.darkModeText;
        document.getElementById("header-dark-mode-text").textContent =
          t.darkModeText;
        document.getElementById("language-text").textContent = t.languageText;
        document.getElementById("logout-text").textContent = t.logoutText;
        document.getElementById("header-logout-text").textContent =
          t.logoutText;
        document.getElementById("select-child-title").textContent =
          t.selectChildTitle;
        document.getElementById("download-report-text").textContent =
          t.downloadReportText;
        if (performanceChart) {
          performanceChart.data.labels = subjectLabels[lang];
          performanceChart.update();
        }
        updateChildData(currentChild);
      }

      const darkModeToggle = document.getElementById("dark-mode-toggle");
      const sidebarDarkModeToggle = document.getElementById(
        "sidebar-dark-mode-toggle"
      );

      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem(
          "darkMode",
          document.body.classList.contains("dark-mode")
        );
      }

      darkModeToggle.addEventListener("click", toggleDarkMode);
      sidebarDarkModeToggle.addEventListener("click", toggleDarkMode);

      if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
      }

      const languageToggle = document.getElementById("sidebar-language-toggle");

      languageToggle.addEventListener("click", (e) => {
        e.preventDefault();
        const isRTL = document.body.classList.contains("rtl");
        if (isRTL) {
          document.body.classList.remove("rtl");
          document.body.classList.add("ltr");
          document.documentElement.lang = "en";
          document.documentElement.dir = "ltr";
          updateLanguage("en");
          localStorage.setItem("language", "en");
        } else {
          document.body.classList.remove("ltr");
          document.body.classList.add("rtl");
          document.documentElement.lang = "ar";
          document.documentElement.dir = "rtl";
          updateLanguage("ar");
          localStorage.setItem("language", "ar");
        }
      });

      if (localStorage.getItem("language") === "en") {
        document.body.classList.remove("rtl");
        document.body.classList.add("ltr");
        document.documentElement.lang = "en";
        document.documentElement.dir = "ltr";
        updateLanguage("en");
      }

      const childTabs = document.querySelectorAll(".child-tab");
      childTabs.forEach((tab) => {
        tab.addEventListener("click", function () {
          childTabs.forEach((t) => t.classList.remove("active"));
          this.classList.add("active");
          currentChild = this.getAttribute("data-child");
          loadReportsDataFor(currentChild);
        });
      });

      function downloadReport() {
        const isRTL = document.body.classList.contains("rtl");
        showToast(
          "info",
          isRTL
            ? "جاري تحميل التقرير بصيغة PDF..."
            : "Downloading report in PDF..."
        );
      }

      const ctx = document.getElementById("performanceChart");
      performanceChart = new Chart(ctx.getContext("2d"), {
        type: "radar",
        data: {
          labels: subjectLabels.ar,
          datasets: [
            {
              label: "الأداء",
              data: [95, 92, 85, 90, 88, 87, 97, 94],
              backgroundColor: "rgba(74, 108, 247, 0.2)",
              borderColor: "rgba(74, 108, 247, 1)",
              borderWidth: 2,
              pointBackgroundColor: "rgba(74, 108, 247, 1)",
              pointBorderColor: "#fff",
              pointHoverBackgroundColor: "#fff",
              pointHoverBorderColor: "rgba(74, 108, 247, 1)",
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            r: {
              beginAtZero: true,
              max: 100,
              ticks: {
                stepSize: 20,
              },
            },
          },
          plugins: {
            legend: {
              display: false,
            },
          },
        },
      });

      const childrenData = {
        "أحمد محمد": {
          summary: {
            overall: "88%",
            rank: "3/8",
            attendance: "95%",
            behavior: "excellent",
          },
          subjects: [
            {
              key: "math",
              exam: "48/50",
              mid: "28/30",
              final: "19/20",
              total: 95,
            },
            {
              key: "science",
              exam: "46/50",
              mid: "27/30",
              final: "19/20",
              total: 92,
            },
            {
              key: "arabic",
              exam: "42/50",
              mid: "26/30",
              final: "17/20",
              total: 85,
            },
            {
              key: "english",
              exam: "45/50",
              mid: "27/30",
              final: "18/20",
              total: 90,
            },
            {
              key: "social",
              exam: "44/50",
              mid: "26/30",
              final: "18/20",
              total: 88,
            },
            {
              key: "islamic",
              exam: "43/50",
              mid: "27/30",
              final: "17/20",
              total: 87,
            },
            {
              key: "art",
              exam: "48/50",
              mid: "29/30",
              final: "20/20",
              total: 97,
            },
            {
              key: "pe",
              exam: "47/50",
              mid: "28/30",
              final: "19/20",
              total: 94,
            },
          ],
          skills: {
            math: 95,
            language: 87,
            critical: 90,
            teamwork: 92,
            creativity: 85,
          },
          achievements: [
            {
              icon: "fa-medal",
              titleAr: "المركز الأول",
              titleEn: "First Place",
              descAr: "مسابقة الرياضيات على مستوى المدرسة",
              descEn: "School-wide Math Competition",
            },
            {
              icon: "fa-star",
              titleAr: "الطالب المثالي",
              titleEn: "Model Student",
              descAr: "شهر أكتوبر 2024",
              descEn: "October 2024",
            },
            {
              icon: "fa-certificate",
              titleAr: "شهادة تفوق",
              titleEn: "Excellence Certificate",
              descAr: "التفوق الأكاديمي للفصل الأول",
              descEn: "Academic Excellence - Term 1",
            },
            {
              icon: "fa-book-reader",
              titleAr: "القارئ النشط",
              titleEn: "Active Reader",
              descAr: "قراءة 20 كتاب خلال الفصل",
              descEn: "Read 20 books in term",
            },
          ],
        },
        "فاطمة محمد": {
          summary: {
            overall: "93%",
            rank: "1/8",
            attendance: "98%",
            behavior: "excellent",
          },
          subjects: [
            {
              key: "math",
              exam: "49/50",
              mid: "29/30",
              final: "19/20",
              total: 97,
            },
            {
              key: "science",
              exam: "47/50",
              mid: "28/30",
              final: "19/20",
              total: 94,
            },
            {
              key: "arabic",
              exam: "45/50",
              mid: "27/30",
              final: "19/20",
              total: 91,
            },
            {
              key: "english",
              exam: "48/50",
              mid: "28/30",
              final: "20/20",
              total: 96,
            },
            {
              key: "social",
              exam: "46/50",
              mid: "27/30",
              final: "19/20",
              total: 92,
            },
            {
              key: "islamic",
              exam: "45/50",
              mid: "28/30",
              final: "19/20",
              total: 92,
            },
            {
              key: "art",
              exam: "49/50",
              mid: "29/30",
              final: "20/20",
              total: 98,
            },
            {
              key: "pe",
              exam: "48/50",
              mid: "29/30",
              final: "20/20",
              total: 97,
            },
          ],
          skills: {
            math: 98,
            language: 93,
            critical: 95,
            teamwork: 96,
            creativity: 90,
          },
          achievements: [
            {
              icon: "fa-medal",
              titleAr: "ميدالية ذهبية",
              titleEn: "Gold Medal",
              descAr: "أولمبياد العلوم",
              descEn: "Science Olympiad",
            },
            {
              icon: "fa-star",
              titleAr: "طالبة الشهر",
              titleEn: "Student of the Month",
              descAr: "نوفمبر 2024",
              descEn: "November 2024",
            },
          ],
        },
        "عمر محمد": {
          summary: {
            overall: "80%",
            rank: "6/8",
            attendance: "92%",
            behavior: "good",
          },
          subjects: [
            {
              key: "math",
              exam: "41/50",
              mid: "24/30",
              final: "17/20",
              total: 82,
            },
            {
              key: "science",
              exam: "39/50",
              mid: "23/30",
              final: "16/20",
              total: 78,
            },
            {
              key: "arabic",
              exam: "40/50",
              mid: "24/30",
              final: "16/20",
              total: 80,
            },
            {
              key: "english",
              exam: "43/50",
              mid: "25/30",
              final: "17/20",
              total: 85,
            },
            {
              key: "social",
              exam: "40/50",
              mid: "24/30",
              final: "17/20",
              total: 81,
            },
            {
              key: "islamic",
              exam: "41/50",
              mid: "25/30",
              final: "16/20",
              total: 82,
            },
            {
              key: "art",
              exam: "45/50",
              mid: "27/30",
              final: "19/20",
              total: 91,
            },
            {
              key: "pe",
              exam: "44/50",
              mid: "26/30",
              final: "18/20",
              total: 88,
            },
          ],
          skills: {
            math: 86,
            language: 78,
            critical: 82,
            teamwork: 84,
            creativity: 80,
          },
          achievements: [
            {
              icon: "fa-certificate",
              titleAr: "شهادة تشجيع",
              titleEn: "Encouragement Certificate",
              descAr: "تحسن ملحوظ في الرياضيات",
              descEn: "Notable improvement in Math",
            },
          ],
        },
      };

      let dbReady = false;
      async function ensureDBOpen() {
        if (!dbReady && window.db) {
          await db.open();
          dbReady = true;
        }
      }

      async function seedReportsIfEmpty() {
        await ensureDBOpen();
        const cntSubjects = await db.reportSubjects.count();
        const cntSummary = await db.reportSummary.count();
        if (cntSubjects === 0 && cntSummary === 0) {
          for (const [name, data] of Object.entries(childrenData)) {
            const s = data.summary || {};
            await db.reportSummary.put({
              childName: name,
              overall: s.overall || "0%",
              rank: s.rank || "-",
              attendance: s.attendance || "0%",
              behavior: s.behavior || "good",
            });
            const subjects = data.subjects || [];
            if (subjects.length)
              await db.reportSubjects.bulkAdd(
                subjects.map((x) => ({
                  childName: name,
                  key: x.key,
                  exam: x.exam,
                  mid: x.mid,
                  final: x.final,
                  total: x.total,
                }))
              );
            const skills = data.skills || {
              math: 0,
              language: 0,
              critical: 0,
              teamwork: 0,
              creativity: 0,
            };
            await db.reportSkills.put({
              childName: name,
              math: skills.math,
              language: skills.language,
              critical: skills.critical,
              teamwork: skills.teamwork,
              creativity: skills.creativity,
            });
            const ach = data.achievements || [];
            if (ach.length)
              await db.reportAchievements.bulkAdd(
                ach.map((a) => ({
                  childName: name,
                  icon: a.icon,
                  titleAr: a.titleAr,
                  titleEn: a.titleEn,
                  descAr: a.descAr,
                  descEn: a.descEn,
                }))
              );
          }
        }
      }

      async function loadReportsDataFor(childName) {
        await seedReportsIfEmpty();
        const summary = await db.reportSummary.get({ childName });
        const subjects = await db.reportSubjects
          .where("childName")
          .equals(childName)
          .toArray();
        const skills = await db.reportSkills.get({ childName });
        const achievements = await db.reportAchievements
          .where("childName")
          .equals(childName)
          .toArray();
        childrenData[childName] = {
          summary: summary || {
            overall: "0%",
            rank: "-",
            attendance: "0%",
            behavior: "good",
          },
          subjects: subjects || [],
          skills: skills || {
            math: 0,
            language: 0,
            critical: 0,
            teamwork: 0,
            creativity: 0,
          },
          achievements: achievements || [],
        };
        updateChildData(childName);
      }

      function subjectNameByKey(key, lang) {
        const map = {
          ar: {
            math: "الرياضيات",
            science: "العلوم",
            arabic: "اللغة العربية",
            english: "اللغة الإنجليزية",
            social: "الدراسات الاجتماعية",
            islamic: "التربية الإسلامية",
            art: "التربية الفنية",
            pe: "التربية البدنية",
          },
          en: {
            math: "Mathematics",
            science: "Science",
            arabic: "Arabic Language",
            english: "English Language",
            social: "Social Studies",
            islamic: "Islamic Studies",
            art: "Art Education",
            pe: "Physical Education",
          },
        };
        return map[lang][key];
      }

      function gradeClass(total) {
        if (total >= 90) return "grade-excellent";
        if (total >= 80) return "grade-good";
        if (total >= 70) return "grade-average";
        return "grade-poor";
      }

      function buildGradesTable(childName) {
        const lang = document.documentElement.lang === "en" ? "en" : "ar";
        const tBody = document.getElementById("grades-tbody");
        tBody.innerHTML = "";
        const data = childrenData[childName];
        if (!data) return;
        data.subjects.forEach((s) => {
          const tr = document.createElement("tr");
          const cls = gradeClass(s.total);
          const evalText =
            gradeText[lang][cls.split("-")[1]] || gradeText[lang].good;
          tr.innerHTML = `
                    <td>${subjectNameByKey(s.key, lang)}</td>
                    <td>${s.exam}</td>
                    <td>${s.mid}</td>
                    <td>${s.final}</td>
                    <td class="${cls}">${s.total}/100</td>
                    <td class="${cls}">${evalText}</td>
                `;
          tBody.appendChild(tr);
        });
        if (performanceChart) {
          performanceChart.data.datasets[0].data = data.subjects.map(
            (s) => s.total
          );
          performanceChart.update();
        }
      }

      function renderAchievements(childName) {
        const lang = document.documentElement.lang === "en" ? "en" : "ar";
        const container = document.getElementById("achievements-grid");
        container.innerHTML = "";
        const data = childrenData[childName];
        if (!data) return;
        data.achievements.forEach((a) => {
          const card = document.createElement("div");
          card.className = "achievement-card";
          card.innerHTML = `
                    <div class="achievement-icon"><i class="fas ${
                      a.icon
                    }"></i></div>
                    <div class="achievement-title">${
                      lang === "en" ? a.titleEn : a.titleAr
                    }</div>
                    <div class="achievement-desc">${
                      lang === "en" ? a.descEn : a.descAr
                    }</div>
                `;
          container.appendChild(card);
        });
      }

      function updateProgressBars(childName) {
        const data = childrenData[childName];
        if (!data) return;
        const fill = (id, val) => {
          const el = document.getElementById(id);
          if (el) {
            el.style.width = val + "%";
            el.textContent = val + "%";
          }
        };
        fill("skill-math-fill", data.skills.math);
        fill("skill-language-fill", data.skills.language);
        fill("skill-critical-fill", data.skills.critical);
        fill("skill-teamwork-fill", data.skills.teamwork);
        fill("skill-creativity-fill", data.skills.creativity);
      }

      function updateSummary(childName) {
        const lang = document.documentElement.lang === "en" ? "en" : "ar";
        const data = childrenData[childName];
        if (!data) return;
        document.getElementById("summary-overall-value").textContent =
          data.summary.overall;
        document.getElementById("summary-rank-value").textContent =
          data.summary.rank;
        document.getElementById("summary-attendance-value").textContent =
          data.summary.attendance;
        const behaviorKey = data.summary.behavior;
        document.getElementById("summary-behavior-value").textContent =
          gradeText[lang][behaviorKey];
      }

      function updateChildData(childName) {
        updateSummary(childName);
        buildGradesTable(childName);
        updateProgressBars(childName);
        renderAchievements(childName);
      }

      currentChild = document
        .querySelector(".child-tab.active")
        .getAttribute("data-child");
      loadReportsDataFor(currentChild);
    </script>
  </body>
</html>
