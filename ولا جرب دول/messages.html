<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الرسائل - DT Edu</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6cf7;
            --primary-dark: #3a5ce5;
            --secondary: #00b894;
            --accent: #ff6b6b;
            
            --bg-color: #f8fafc;
            --sidebar-bg: #ffffff;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --input-bg: #f1f5f9;
            
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-light: #64748b;
            
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;
            
            --hover-bg: #f8fafc;
            --active-bg: #eff6ff;
            
            --message-received-bg: #f1f5f9;
            
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .dark-mode {
            --primary: #5b7cf9;
            --primary-dark: #4a6cf7;
            --secondary: #00d8a7;
            --accent: #ff7b7b;
            
            --bg-color: #0f172a;
            --sidebar-bg: #1e293b;
            --card-bg: #1e293b;
            --header-bg: #1e293b;
            --input-bg: #334155;
            
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-light: #94a3b8;
            
            --border-color: #334155;
            --border-light: #475569;
            
            --hover-bg: #334155;
            --active-bg: #374151;
            
            --message-received-bg: #334155;
            
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        #app {
            min-height: 100vh;
            display: flex;
        }

        .three-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .three-scene.active {
            opacity: 0.3;
            z-index: 0;
        }

        .three-canvas {
            width: 100%;
            height: 100%;
        }

        .scene-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
        }

        .scene-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .scene-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .dashboard-container {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        .sidebar.compact {
            width: 80px;
        }

        .sidebar.compact .logo-text,
        .sidebar.compact .user-info,
        .sidebar.compact .menu-item span {
            display: none;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .logo {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .user-info .user-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-info .user-type {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .sidebar-menu {
            flex: 1;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-item {
            margin: 5px 0;
        }

        .menu-item a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 0 8px 8px 0;
            margin-right: 10px;
        }

        .menu-item a:hover {
            background: var(--hover-bg);
            color: var(--primary);
            transform: translateX(-5px);
        }

        .menu-item a.active {
            background: var(--active-bg);
            color: var(--primary);
            font-weight: 600;
        }

        .menu-item a i {
            margin-left: 10px;
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            border-top: 1px solid var(--border-color);
            padding: 10px 0;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: var(--header-bg);
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .dark-mode-toggle, .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode-toggle:hover, .back-btn:hover {
            background: var(--hover-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .messages-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .conversations-list {
            width: 350px;
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .conversations-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .conversations-title {
            color: var(--primary);
            margin: 0;
            font-size: 1.3rem;
        }

        .new-message-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .new-message-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .search-container {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .search-input {
            position: relative;
        }

        .search-input i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .search-input input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .search-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.2);
        }

        .conversations-container {
            flex: 1;
            overflow-y: auto;
        }

        .conversation-item {
            display: flex;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--border-light);
            position: relative;
        }

        .conversation-item:hover {
            background: var(--hover-bg);
        }

        .conversation-item.active {
            background: var(--active-bg);
        }

        .conversation-item.active::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--primary);
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-left: 15px;
            flex-shrink: 0;
        }

        .conversation-info {
            flex: 1;
            min-width: 0;
        }

        .conversation-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .conversation-preview {
            color: var(--text-light);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .conversation-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .unread-badge {
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            background: var(--card-bg);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .chat-user-info {
            display: flex;
            align-items: center;
        }

        .chat-user-info .conversation-avatar {
            width: 45px;
            height: 45px;
            margin-left: 15px;
        }

        .conversation-status {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .chat-action-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-action-btn:hover {
            background: var(--hover-bg);
            color: var(--primary);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message.sent .message-bubble {
            background: var(--primary);
            color: white;
            border-radius: 18px 18px 0 18px;
        }

        .message.sent .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .message.received {
            justify-content: flex-start;
        }

        .message.received .message-bubble {
            background: var(--message-received-bg);
            color: var(--text-primary);
            border-radius: 18px 18px 18px 0;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .message-text {
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .message-time {
            font-size: 0.7rem;
            text-align: left;
        }

        .chat-input {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            gap: 10px;
        }

        .input-actions {
            display: flex;
            gap: 5px;
        }

        .input-action-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .input-action-btn:hover {
            background: var(--hover-bg);
            color: var(--primary);
        }

        .message-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.2);
        }

        .send-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .send-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .send-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .no-conversation-selected {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card-bg);
        }

        .placeholder-content {
            text-align: center;
            max-width: 400px;
            padding: 30px;
        }

        .placeholder-icon {
            width: 80px;
            height: 80px;
            background: var(--active-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: var(--primary);
            font-size: 2rem;
        }

        .placeholder-content h3 {
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .placeholder-content p {
            color: var(--text-light);
            margin-bottom: 25px;
        }

        .new-conversation-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .new-conversation-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .message {
            animation: messageAppear 0.3s ease;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .sidebar.compact {
                height: 70px;
            }
            
            .sidebar.compact .sidebar-menu, 
            .sidebar.compact .sidebar-footer {
                display: none;
            }
            
            .messages-container {
                flex-direction: column;
            }
            
            .conversations-list {
                width: 100%;
                height: 300px;
            }
            
            .header {
                padding: 10px 15px;
            }
            
            .header-title {
                font-size: 1.2rem;
            }
            
            .header-actions {
                gap: 8px;
            }
            
            .dark-mode-toggle, .back-btn {
                padding: 6px 10px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- مشهد Three.js في الخلفية -->
        <div class="three-scene" :class="{ 'active': showThreeScene }">
            <canvas ref="canvas" class="three-canvas"></canvas>
            <div class="scene-controls" v-if="showThreeScene">
                <button @click="toggleScene" class="scene-toggle">
                    <i class="fas" :class="sceneActive ? 'fa-pause' : 'fa-play'"></i>
                </button>
            </div>
        </div>
        
        <div class="dashboard-container">
            <!-- الشريط الجانبي -->
            <div class="sidebar" :class="{'compact': isCompact}">
                <div class="sidebar-header">
                    <div class="logo-container">
                        <div class="logo">
                            <svg width="50" height="50" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stop-color="#4a6cf7"/>
                                        <stop offset="100%" stop-color="#00b894"/>
                                    </linearGradient>
                                </defs>
                                <circle cx="48" cy="48" r="46" fill="url(#grad)" opacity="0.15" stroke="#4a6cf7" stroke-width="2"/>
                                <path d="M28 62C28 48.745 38.745 38 52 38H60V46H52C43.163 46 36 53.163 36 62H28Z" fill="#4a6cf7"/>
                                <path d="M40 58C40 44.745 50.745 34 64 34H72V42H64C55.163 42 48 49.163 48 58H40Z" fill="#00b894" opacity="0.85"/>
                                <circle cx="60" cy="32" r="8" fill="#4a6cf7" opacity="0.75"/>
                                <circle cx="36" cy="60" r="6" fill="#00b894" opacity="0.8"/>
                            </svg>
                        </div>
                    </div>
                    <div class="logo-text">DT Edu</div>
                    <div class="user-info">
                        <div class="user-name">محمد أحمد</div>
                        <div class="user-type">طالب</div>
                    </div>
                </div>
                
                <ul class="sidebar-menu">
                    <li class="menu-item" v-for="item in menuItems" :key="item.id" :class="{ 'active': item.active }">
                        <a :href="item.link" @click.prevent="navigateTo(item)">
                            <i :class="item.icon"></i>
                            <span>{{ item.text }}</span>
                        </a>
                    </li>
                </ul>
                
                <div class="sidebar-footer">
                    <ul class="sidebar-menu">
                        <li class="menu-item">
                            <a href="#" @click.prevent="toggleDarkMode">
                                <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
                                <span>{{ darkMode ? 'الوضع الفاتح' : 'الوضع الداكن' }}</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="#" @click.prevent="toggleThreeScene">
                                <i class="fas fa-cube"></i>
                                <span>المشهد التفاعلي</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="#" @click.prevent="logout">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>تسجيل الخروج</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- المحتوى الرئيسي -->
            <div class="main-content">
                <div class="header">
                    <h1 class="header-title">الرسائل - نظام DT Edu</h1>
                    <div class="header-actions">
                        <button class="dark-mode-toggle" @click="toggleDarkMode">
                            <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
                            <span>{{ darkMode ? 'الوضع الفاتح' : 'الوضع الداكن' }}</span>
                        </button>
                        <button class="back-btn" @click="goBack">
                            <i class="fas fa-arrow-right"></i>
                            <span>العودة</span>
                        </button>
                    </div>
                </div>
                
                <!-- محتوى الرسائل -->
                <div class="messages-container">
                    <!-- قائمة المحادثات -->
                    <div class="conversations-list">
                        <div class="conversations-header">
                            <h3 class="conversations-title">المحادثات</h3>
                            <button class="new-message-btn" @click="newMessage">
                                <i class="fas fa-plus"></i>
                                <span>رسالة جديدة</span>
                            </button>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-input">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="ابحث في المحادثات..." v-model="searchQuery">
                            </div>
                        </div>
                        
                        <div class="conversations-container">
                            <div 
                                v-for="conversation in filteredConversations" 
                                :key="conversation.id"
                                class="conversation-item" 
                                :class="{ 'active': activeConversation && activeConversation.id === conversation.id }"
                                @click="selectConversation(conversation)"
                            >
                                <div class="conversation-avatar" :style="{ backgroundColor: getAvatarColor(conversation.avatar) }">
                                    {{ conversation.avatar }}
                                </div>
                                <div class="conversation-info">
                                    <div class="conversation-name">{{ conversation.name }}</div>
                                    <div class="conversation-preview">{{ conversation.preview }}</div>
                                </div>
                                <div class="conversation-meta">
                                    <div class="conversation-time">{{ conversation.time }}</div>
                                    <div class="unread-badge" v-if="conversation.unread > 0">
                                        {{ conversation.unread }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- نافذة المحادثة -->
                    <div class="chat-container" v-if="activeConversation">
                        <div class="chat-header">
                            <div class="chat-user-info">
                                <div class="conversation-avatar" :style="{ backgroundColor: getAvatarColor(activeConversation.avatar) }">
                                    {{ activeConversation.avatar }}
                                </div>
                                <div>
                                    <div class="conversation-name">{{ activeConversation.name }}</div>
                                    <div class="conversation-status">{{ activeConversation.status }}</div>
                                </div>
                            </div>
                            <div class="chat-actions">
                                <button class="chat-action-btn">
                                    <i class="fas fa-phone"></i>
                                </button>
                                <button class="chat-action-btn">
                                    <i class="fas fa-video"></i>
                                </button>
                                <button class="chat-action-btn">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="chat-messages" ref="messagesContainer">
                            <div 
                                v-for="message in activeConversation.messages" 
                                :key="message.id"
                                class="message" 
                                :class="message.sent ? 'sent' : 'received'"
                            >
                                <div class="message-bubble">
                                    <div class="message-text">{{ message.text }}</div>
                                    <div class="message-time">{{ message.time }}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chat-input">
                            <div class="input-actions">
                                <button class="input-action-btn">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button class="input-action-btn">
                                    <i class="fas fa-smile"></i>
                                </button>
                            </div>
                            <input 
                                type="text" 
                                class="message-input" 
                                v-model="newMessageText" 
                                placeholder="اكتب رسالتك هنا..." 
                                @keyup.enter="sendMessage"
                                ref="messageInput"
                            >
                            <button class="send-btn" @click="sendMessage" :disabled="!newMessageText.trim()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- حالة عدم وجود محادثة محددة -->
                    <div v-else class="no-conversation-selected">
                        <div class="placeholder-content">
                            <div class="placeholder-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <h3>اختر محادثة للبدء</h3>
                            <p>اختر محادثة من القائمة لبدء المحادثة أو أنشئ رسالة جديدة</p>
                            <button class="new-conversation-btn" @click="newMessage">
                                <i class="fas fa-plus"></i>
                                بدء محادثة جديدة
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, computed, onMounted, watch, nextTick } = Vue;
        
        createApp({
            setup() {
                // حالة التطبيق
                const darkMode = ref(false);
                const showThreeScene = ref(false);
                const sceneActive = ref(true);
                const activeConversation = ref(null);
                const isCompact = ref(false);
                const searchQuery = ref('');
                const newMessageText = ref('');
                const canvas = ref(null);
                const messagesContainer = ref(null);
                const messageInput = ref(null);
                
                // بيانات القائمة الجانبية
                const menuItems = reactive([
                    { id: 1, text: 'لوحة التحكم', icon: 'fas fa-home', link: 'dashboard.html', active: false },
                    { id: 2, text: 'الجدول الدراسي', icon: 'fas fa-calendar-alt', link: 'schedule.html', active: false },
                    { id: 3, text: 'المقررات الدراسية', icon: 'fas fa-book', link: 'courses.html', active: false },
                    { id: 4, text: 'التقدم الدراسي', icon: 'fas fa-chart-bar', link: 'progress.html', active: false },
                    { id: 5, text: 'الرسائل', icon: 'fas fa-comments', link: 'messages.html', active: true },
                    { id: 6, text: 'الإعدادات', icon: 'fas fa-cog', link: 'settings.html', active: false }
                ]);
                
                // بيانات المحادثات
                const conversations = reactive([
                    {
                        id: 1,
                        name: 'أ. أحمد محمد',
                        avatar: 'أ.أ',
                        preview: 'هل انتهيت من حل تمارين الواجب؟',
                        time: '10:30 ص',
                        unread: 2,
                        status: 'مدرس الرياضيات - متصل الآن',
                        messages: [
                            { id: 1, text: 'مرحباً محمد، هل انتهيت من حل تمارين الواجب؟', time: '10:15 ص', sent: false },
                            { id: 2, text: 'نعم أستاذ، انتهيت من معظم التمارين ولكن لدي سؤال في التمرين رقم ٥', time: '10:20 ص', sent: true },
                            { id: 3, text: 'أهلاً وسهلاً، ما هو السؤال الذي تواجهك؟', time: '10:25 ص', sent: false }
                        ]
                    },
                    {
                        id: 2,
                        name: 'أ. فاطمة علي',
                        avatar: 'أ.ف',
                        preview: 'نتيجة اختبار العلوم جاهزة',
                        time: 'أمس',
                        unread: 0,
                        status: 'مدرسة العلوم',
                        messages: [
                            { id: 1, text: 'نتيجة اختبار العلوم جاهزة الآن', time: '09:15 ص', sent: false },
                            { id: 2, text: 'شكراً أستاذة، هل يمكنني الاطلاع عليها؟', time: '09:20 ص', sent: true }
                        ]
                    },
                    {
                        id: 3,
                        name: 'مدير المدرسة',
                        avatar: 'م.ح',
                        preview: 'اجتماع أولياء الأمور يوم الخميس',
                        time: '١٥ مايو',
                        unread: 0,
                        status: 'مدير المدرسة',
                        messages: [
                            { id: 1, text: 'اجتماع أولياء الأمور سيعقد يوم الخميس القادم', time: '08:00 ص', sent: false },
                            { id: 2, text: 'شكراً للمعلومة، سأحضر إن شاء الله', time: '08:05 ص', sent: true }
                        ]
                    },
                    {
                        id: 4,
                        name: 'زميل الدراسة',
                        avatar: 'ز.م',
                        preview: 'هل يمكنك مساعدتي في فهم هذا الدرس؟',
                        time: '١٤ مايو',
                        unread: 1,
                        status: 'زميل الدراسة',
                        messages: [
                            { id: 1, text: 'مرحباً، هل يمكنك مساعدتي في فهم درس الرياضيات؟', time: '14:00 م', sent: false },
                            { id: 2, text: 'بالطبع، أي جزء تحتاج مساعدة فيه؟', time: '14:05 م', sent: true }
                        ]
                    }
                ]);
                
                // متغيرات Three.js
                let scene, camera, renderer, animationId;
                
                // تصفية المحادثات بناءً على البحث
                const filteredConversations = computed(() => {
                    if (!searchQuery.value) return conversations;
                    
                    return conversations.filter(conversation => 
                        conversation.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                        conversation.preview.toLowerCase().includes(searchQuery.value.toLowerCase())
                    );
                });
                
                // تبديل الوضع الداكن
                const toggleDarkMode = () => {
                    darkMode.value = !darkMode.value;
                    document.body.classList.toggle('dark-mode', darkMode.value);
                };
                
                // تبديل مشهد Three.js
                const toggleThreeScene = () => {
                    showThreeScene.value = !showThreeScene.value;
                    if (showThreeScene.value) {
                        initThreeScene();
                    } else {
                        cleanupThreeScene();
                    }
                };
                
                // تبديل حالة المشهد
                const toggleScene = () => {
                    sceneActive.value = !sceneActive.value;
                };
                
                // التنقل في القائمة
                const navigateTo = (item) => {
                    menuItems.forEach(i => i.active = false);
                    item.active = true;
                };
                
                // تسجيل الخروج
                const logout = () => {
                    if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                        alert('تم تسجيل الخروج بنجاح');
                    }
                };
                
                // اختيار محادثة
                const selectConversation = (conversation) => {
                    activeConversation.value = conversation;
                    // إزالة الإشعارات غير المقروءة عند فتح المحادثة
                    if (conversation.unread > 0) {
                        conversation.unread = 0;
                    }
                    
                    // التمرير لأسفل عند فتح المحادثة
                    nextTick(() => {
                        scrollToBottom();
                    });
                };
                
                // إرسال رسالة جديدة
                const sendMessage = () => {
                    if (!newMessageText.value.trim()) return;
                    
                    const newMessage = {
                        id: activeConversation.value.messages.length + 1,
                        text: newMessageText.value,
                        time: new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' }),
                        sent: true
                    };
                    
                    activeConversation.value.messages.push(newMessage);
                    activeConversation.value.preview = newMessageText.value;
                    activeConversation.value.time = 'الآن';
                    
                    newMessageText.value = '';
                    
                    // محاكاة رد بعد ثانية
                    setTimeout(() => {
                        const replyMessage = {
                            id: activeConversation.value.messages.length + 1,
                            text: 'شكراً على رسالتك، سأرد عليك قريباً',
                            time: new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' }),
                            sent: false
                        };
                        
                        activeConversation.value.messages.push(replyMessage);
                        activeConversation.value.preview = replyMessage.text;
                        
                        // التمرير لأسفل بعد الرد
                        nextTick(() => {
                            scrollToBottom();
                        });
                    }, 1000);
                    
                    // التركيز على حقل الإدخال بعد الإرسال
                    nextTick(() => {
                        if (messageInput.value) {
                            messageInput.value.focus();
                        }
                    });
                };
                
                // بدء محادثة جديدة
                const newMessage = () => {
                    alert('سيتم فتح نافذة لبدء محادثة جديدة في التطبيق الكامل');
                };
                
                // العودة للخلف
                const goBack = () => {
                    window.history.back();
                };
                
                // توليد لون فريد للصورة الرمزية
                const getAvatarColor = (text) => {
                    let hash = 0;
                    for (let i = 0; i < text.length; i++) {
                        hash = text.charCodeAt(i) + ((hash << 5) - hash);
                    }
                    
                    const hue = hash % 360;
                    return `hsl(${hue}, 70%, 65%)`;
                };
                
                // التمرير لأسفل في نافذة المحادثة
                const scrollToBottom = () => {
                    if (messagesContainer.value) {
                        messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;
                    }
                };
                
                // تهيئة مشهد Three.js
                const initThreeScene = () => {
                    if (!canvas.value) return;
                    
                    // إنشاء المشهد
                    scene = new THREE.Scene();
                    
                    // إنشاء الكاميرا
                    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                    camera.position.z = 5;
                    
                    // إنشاء العارض
                    renderer = new THREE.WebGLRenderer({ 
                        canvas: canvas.value, 
                        alpha: true,
                        antialias: true 
                    });
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    renderer.setClearColor(0x000000, 0); // خلفية شفافة
                    
                    // إضافة الإضاءة
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                    scene.add(ambientLight);
                    
                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(1, 1, 1);
                    scene.add(directionalLight);
                    
                    // إنشاء الأشكال الهندسية
                    createGeometries();
                    
                    // بدء الرسوم المتحركة
                    animate();
                    
                    // إضافة مستمعات الأحداث
                    window.addEventListener('resize', onWindowResize);
                    window.addEventListener('mousemove', onMouseMove);
                };
                
                // إنشاء الأشكال الهندسية
                const createGeometries = () => {
                    // إنشاء مجموعة من الأشكال العائمة
                    const geometries = [
                        new THREE.IcosahedronGeometry(0.5, 0),
                        new THREE.OctahedronGeometry(0.4, 0),
                        new THREE.TetrahedronGeometry(0.3, 0),
                        new THREE.SphereGeometry(0.35, 12, 8)
                    ];
                    
                    const materials = [
                        new THREE.MeshPhongMaterial({ 
                            color: 0x4a6cf7, 
                            transparent: true, 
                            opacity: 0.6 
                        }),
                        new THREE.MeshPhongMaterial({ 
                            color: 0x00b894, 
                            transparent: true, 
                            opacity: 0.6 
                        }),
                        new THREE.MeshPhongMaterial({ 
                            color: 0xff6b6b, 
                            transparent: true, 
                            opacity: 0.6 
                        }),
                        new THREE.MeshPhongMaterial({ 
                            color: 0xffd166, 
                            transparent: true, 
                            opacity: 0.6 
                        })
                    ];
                    
                    // إنشاء 10 أشكال عشوائية
                    for (let i = 0; i < 10; i++) {
                        const geometry = geometries[Math.floor(Math.random() * geometries.length)];
                        const material = materials[Math.floor(Math.random() * materials.length)];
                        
                        const mesh = new THREE.Mesh(geometry, material);
                        
                        // وضع عشوائي
                        mesh.position.x = (Math.random() - 0.5) * 10;
                        mesh.position.y = (Math.random() - 0.5) * 10;
                        mesh.position.z = (Math.random() - 0.5) * 5;
                        
                        // دوران عشوائي
                        mesh.rotation.x = Math.random() * Math.PI;
                        mesh.rotation.y = Math.random() * Math.PI;
                        
                        // إضافة خاصية السرعة
                        mesh.userData = {
                            speed: {
                                x: (Math.random() - 0.5) * 0.01,
                                y: (Math.random() - 0.5) * 0.01,
                                z: (Math.random() - 0.5) * 0.01
                            },
                            rotation: {
                                x: (Math.random() - 0.5) * 0.01,
                                y: (Math.random() - 0.5) * 0.01
                            }
                        };
                        
                        scene.add(mesh);
                    }
                };
                
                // الرسوم المتحركة
                const animate = () => {
                    animationId = requestAnimationFrame(animate);
                    
                    if (scene && sceneActive.value) {
                        // تحديث موقع ودوران كل شكل
                        scene.children.forEach(child => {
                            if (child.isMesh && child.userData.speed) {
                                // تحديث الموقع
                                child.position.x += child.userData.speed.x;
                                child.position.y += child.userData.speed.y;
                                child.position.z += child.userData.speed.z;
                                
                                // الحدود - ارتداد عند الحواف
                                if (Math.abs(child.position.x) > 5) child.userData.speed.x *= -1;
                                if (Math.abs(child.position.y) > 5) child.userData.speed.y *= -1;
                                if (Math.abs(child.position.z) > 3) child.userData.speed.z *= -1;
                                
                                // تحديث الدوران
                                child.rotation.x += child.userData.rotation.x;
                                child.rotation.y += child.userData.rotation.y;
                            }
                        });
                        
                        // تدوير المشهد قليلاً
                        scene.rotation.y += 0.001;
                        
                        renderer.render(scene, camera);
                    }
                };
                
                // عند تحرك الماوس
                const onMouseMove = (event) => {
                    if (!camera) return;
                    
                    // تأثير بارالاكس خفيف
                    const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                    const mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
                    
                    camera.position.x = mouseX * 0.5;
                    camera.position.y = mouseY * 0.5;
                    camera.lookAt(scene.position);
                };
                
                // عند تغيير حجم النافذة
                const onWindowResize = () => {
                    if (!camera || !renderer) return;
                    
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                };
                
                // تنظيف مشهد Three.js
                const cleanupThreeScene = () => {
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                    }
                    
                    window.removeEventListener('resize', onWindowResize);
                    window.removeEventListener('mousemove', onMouseMove);
                    
                    if (scene) {
                        scene.traverse(object => {
                            if (object.isMesh) {
                                object.geometry.dispose();
                                object.material.dispose();
                            }
                        });
                    }
                    
                    if (renderer) {
                        renderer.dispose();
                    }
                };
                
                onMounted(() => {
                    // تحديد المحادثة الأولى بشكل افتراضي
                    if (conversations.length > 0) {
                        activeConversation.value = conversations[0];
                    }
                    
                    // إضافة مستمع للتمرير لأسفل عند إضافة رسائل جديدة
                    watch(() => activeConversation.value?.messages, () => {
                        nextTick(() => {
                            scrollToBottom();
                        });
                    }, { deep: true });
                });
                
                return {
                    darkMode,
                    showThreeScene,
                    sceneActive,
                    activeConversation,
                    isCompact,
                    searchQuery,
                    newMessageText,
                    canvas,
                    messagesContainer,
                    messageInput,
                    menuItems,
                    conversations,
                    filteredConversations,
                    toggleDarkMode,
                    toggleThreeScene,
                    toggleScene,
                    navigateTo,
                    logout,
                    selectConversation,
                    sendMessage,
                    newMessage,
                    goBack,
                    getAvatarColor
                };
            }
        }).mount('#app');
    </script>
</body>
</html>